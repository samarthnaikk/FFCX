<!-- All Modal Components -->

<!-- Export Modal -->
<div class="modal fade" id="exportModal" v-if="showExportModal" style="display: block; background: rgba(0,0,0,0.5);">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-download me-2"></i>Export Timetable
                </h5>
                <button type="button" class="btn-close" @click="closeExportModal"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted">Share your timetable by copying the code below:</p>
                
                <div class="code-container">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <label class="form-label fw-bold">Timetable Code:</label>
                        <button class="btn btn-outline-primary btn-sm" @click="copyCode">
                            <i :class="copyIcon"></i> {{ copyStatus }}
                        </button>
                    </div>
                    <textarea 
                        class="form-control font-monospace" 
                        rows="10" 
                        readonly 
                        :value="generatedCode"
                        style="font-size: 0.9em;">
                    </textarea>
                </div>
                
                <div class="alert alert-info mt-3">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>How to use:</strong> Copy this code and share it with others. They can import it using the Import feature.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" @click="closeExportModal">Close</button>
                <button type="button" class="btn btn-primary" @click="copyCode">
                    <i class="fas fa-copy me-2"></i>Copy Code
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Import Modal -->
<div class="modal fade" id="importModal" v-if="showImportModalFlag" style="display: block; background: rgba(0,0,0,0.5);">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-upload me-2"></i>Import Timetable
                </h5>
                <button type="button" class="btn-close" @click="closeImportModal"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted">Paste a timetable code to import:</p>
                
                <div class="mb-3">
                    <label for="importCode" class="form-label fw-bold">Timetable Code:</label>
                    <textarea 
                        id="importCode"
                        class="form-control font-monospace" 
                        rows="8" 
                        v-model="importCode"
                        placeholder="Paste the timetable code here..."
                        style="font-size: 0.9em;">
                    </textarea>
                </div>
                
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Note:</strong> This will replace your current timetable. Make sure to export your current timetable first if you want to keep it.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" @click="closeImportModal">Cancel</button>
                <button 
                    type="button" 
                    class="btn btn-primary" 
                    @click="importTimetable"
                    :disabled="!importCode.trim() || loadingImport">
                    <span v-if="loadingImport">
                        <i class="fas fa-spinner fa-spin me-2"></i>Importing...
                    </span>
                    <span v-else>
                        <i class="fas fa-upload me-2"></i>Import Timetable
                    </span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Preferences Modal -->
<div class="modal fade" id="preferencesModal" v-if="showPreferences" style="display: block; background: rgba(0,0,0,0.5);">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-magic me-2"></i>Optimize Timetable
                </h5>
                <button type="button" class="btn-close" @click="closePreferencesModal"></button>
            </div>
            <div class="modal-body">
                <!-- Priority Validation Status -->
                <div v-if="validateAllPriorities().length > 0" class="alert alert-danger">
                    <h6><i class="fas fa-exclamation-triangle me-2"></i>Priority Conflicts Detected:</h6>
                    <ul class="mb-0">
                        <li v-for="error in validateAllPriorities()" :key="error">{{ error }}</li>
                    </ul>
                    <hr>
                    <small>Please fix these conflicts before optimizing your timetable.</small>
                </div>
                
                <div v-else class="alert alert-success">
                    <i class="fas fa-check-circle me-2"></i>
                    All priorities are valid! You can now optimize your timetable.
                </div>

                <!-- Course Preferences -->
                <div class="preferences-section">
                    <h6>Course Preferences</h6>
                    
                    <!-- Add New Course -->
                    <div class="add-course-section mb-4 p-3 border rounded">
                        <h6 class="small text-muted mb-3">Add New Course:</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="position-relative">
                                    <input 
                                        type="text" 
                                        class="form-control" 
                                        placeholder="Search course name..."
                                        v-model="newCourseSearchQuery"
                                        @input="searchCoursesForPreferences">
                                    
                                    <!-- Search dropdown for preferences -->
                                    <div v-if="showPreferenceCourseDropdown" class="search-dropdown position-absolute w-100 mt-1">
                                        <div class="list-group shadow">
                                            <button 
                                                v-for="course in preferenceSearchResults.slice(0, 5)" 
                                                :key="course.course_code"
                                                class="list-group-item list-group-item-action small"
                                                @click="selectCourseForPreference(course)">
                                                <strong>{{ course.title }}</strong><br>
                                                <small class="text-muted">{{ course.course_code }}</small>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <input 
                                    type="text" 
                                    class="form-control" 
                                    placeholder="Course code"
                                    v-model="newCoursePreference.code">
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-primary btn-sm w-100" @click="addNewCoursePreference">
                                    <i class="fas fa-plus"></i> Add
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Existing Course Preferences -->
                    <div v-for="(pref, courseName) in preferences" :key="courseName" class="preference-item mb-3 p-3 border rounded">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h6 class="mb-1">{{ courseName }}</h6>
                                <small class="text-muted">{{ pref.code || 'No code' }}</small>
                            </div>
                            <button class="btn btn-outline-danger btn-sm" @click="removeCoursePreference(courseName)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        
                        <!-- Course Priority -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label small">Course Priority (1-10):</label>
                                <input 
                                    type="number" 
                                    class="form-control" 
                                    min="1" 
                                    max="10"
                                    v-model.number="pref.priority"
                                    @change="validateCoursePriority(courseName, pref.priority)">
                            </div>
                        </div>
                        
                        <!-- Teacher Options -->
                        <div class="teacher-options">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <label class="form-label small mb-0">Teacher Options:</label>
                                <button class="btn btn-outline-success btn-sm" @click="addTeacherOption(courseName)">
                                    <i class="fas fa-plus"></i> Add Teacher
                                </button>
                            </div>
                            
                            <div v-for="(option, index) in pref.teacherOptions" :key="index" class="teacher-option mb-2 p-2 border rounded">
                                <div class="row">
                                    <div class="col-md-3">
                                        <input 
                                            type="text" 
                                            class="form-control form-control-sm" 
                                            placeholder="Faculty name"
                                            v-model="option.faculty">
                                    </div>
                                    <div class="col-md-3">
                                        <input 
                                            type="text" 
                                            class="form-control form-control-sm" 
                                            placeholder="Slots"
                                            v-model="option.slots">
                                    </div>
                                    <div class="col-md-2">
                                        <input 
                                            type="text" 
                                            class="form-control form-control-sm" 
                                            placeholder="Venue"
                                            v-model="option.venue">
                                    </div>
                                    <div class="col-md-2">
                                        <input 
                                            type="number" 
                                            class="form-control form-control-sm" 
                                            placeholder="Priority"
                                            min="1" 
                                            max="10"
                                            v-model.number="option.priority"
                                            @change="validateTeacherPriority(courseName, index, option.priority)">
                                    </div>
                                    <div class="col-md-2">
                                        <button class="btn btn-outline-danger btn-sm w-100" @click="removeTeacherOption(courseName, index)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" @click="savePreferences">
                    <i class="fas fa-save me-2"></i>Save Preferences
                </button>
                <button type="button" class="btn btn-secondary" @click="closePreferencesModal">Cancel</button>
                <button 
                    type="button" 
                    class="btn btn-primary" 
                    @click="optimizeTimetable"
                    :disabled="!canOptimize()">
                    <i class="fas fa-magic me-2"></i>Optimize Timetable
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Help Modal -->
<div class="modal fade" id="helpModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-question-circle me-2"></i>How to Use FFCX
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Basic Usage:</h6>
                        <ul>
                            <li>Search for courses using the search box</li>
                            <li>Click on a course to select it</li>
                            <li>Click "Add to Timetable" to add the course</li>
                            <li>Drag and drop courses to move them between time slots</li>
                        </ul>
                        
                        <h6>Optimization:</h6>
                        <ul>
                            <li>Click "Optimize" to auto-arrange your courses</li>
                            <li>Set priorities for courses and teachers</li>
                            <li>Higher priority courses get scheduled first</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Export & Import:</h6>
                        <ul>
                            <li>Export your timetable to share with others</li>
                            <li>Import timetables using the generated codes</li>
                            <li>Save your preferences in browser storage</li>
                        </ul>
                        
                        <h6>Keyboard Shortcuts:</h6>
                        <ul>
                            <li><kbd>Ctrl+D</kbd> - Toggle dark mode</li>
                            <li><kbd>Ctrl+E</kbd> - Export timetable</li>
                            <li><kbd>Ctrl+I</kbd> - Import timetable</li>
                            <li><kbd>Ctrl+P</kbd> - Open preferences</li>
                            <li><kbd>Esc</kbd> - Close modals</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- About Modal -->
<div class="modal fade" id="aboutModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-info-circle me-2"></i>About FFCX
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-3">
                    <i class="fas fa-calendar-alt fa-3x text-primary mb-3"></i>
                    <h4>FFCX v2.0</h4>
                    <p class="text-muted">VIT FFCS Timetable Generator</p>
                </div>
                
                <p>FFCX is a modern, user-friendly timetable generator designed specifically for VIT University's FFCS (Fully Flexible Credit System).</p>
                
                <h6>Features:</h6>
                <ul>
                    <li>Interactive drag-and-drop interface</li>
                    <li>Intelligent course optimization</li>
                    <li>Priority-based scheduling</li>
                    <li>Export/import functionality</li>
                    <li>Dark mode support</li>
                    <li>Responsive design</li>
                </ul>
                
                <hr>
                <p class="small text-muted mb-0">
                    Built with Vue.js 3, Bootstrap 5, and Flask.<br>
                    © 2024 FFCX Team. All rights reserved.
                </p>
            </div>
        </div>
    </div>
</div>