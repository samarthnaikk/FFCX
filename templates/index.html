<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFCX - Collaborative FFCS Planner</title>
    
    <!-- Vue.js 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Bootstrap CSS for styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <style>
        .timetable-container {
            margin-top: 20px;
        }
        
        .time-slot {
            min-height: 60px;
            border: 1px solid #dee2e6;
            padding: 8px;
            margin-bottom: 2px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .time-slot.occupied {
            cursor: pointer;
            color: #333;
        }
        
        .time-slot.occupied.theory-slot {
            background-color: rgba(0, 123, 255, 0.1);
            border-left: 4px solid #007bff;
        }
        
        .time-slot.occupied.lab-slot {
            background-color: rgba(40, 167, 69, 0.1);
            border-left: 4px solid #28a745;
        }
        
        .time-slot.occupied:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .time-slot.free {
            background-color: #f8f9fa;
            color: #6c757d;
            border-style: dashed;
        }
        
        .day-header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
        }
        
        .course-code {
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .course-name {
            font-size: 0.8em;
            margin: 2px 0;
        }
        
        .faculty-venue {
            font-size: 0.7em;
            opacity: 0.9;
        }
        
        .slot-info {
            margin-top: 4px;
            padding-top: 4px;
            border-top: 1px solid rgba(255,255,255,0.3);
        }
        
        .selected-slot {
            font-size: 0.7em;
            font-weight: bold;
            color: #fff;
            opacity: 1;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .time-slot.occupied.lab-slot .selected-slot span {
            color: #28a745;
            font-weight: bold;
        }
        
        .time-slot.occupied.theory-slot .selected-slot span {
            color: #007bff;
            font-weight: bold;
        }
        
        .selected-slot i {
            color: #28a745;
        }
        
        .available-slots {
            font-size: 0.6em;
            opacity: 0.8;
            font-style: italic;
            margin-top: 2px;
        }
        
        .available-slots-free {
            font-size: 0.7em;
            color: #6c757d;
            font-style: italic;
            margin-top: 2px;
        }
        
        .free-period-info {
            text-align: center;
        }
        
        .add-course-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8em;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-bottom: 4px;
        }
        
        .add-course-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        }
        
        .add-course-btn i {
            font-size: 1.1em;
        }
        
        .time-label {
            font-size: 0.65em;
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            padding: 2px 6px;
            background-color: rgba(248, 249, 250, 0.8);
            border-radius: 4px;
            text-align: center;
        }
        
        .time-label-compact {
            font-size: 0.55em;
            font-weight: 600;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .theory-time {
            color: #007bff;
            background-color: rgba(0, 123, 255, 0.1);
            padding: 1px 4px;
            border-radius: 3px;
            margin-bottom: 2px;
        }
        
        .lab-time {
            color: #28a745;
            background-color: rgba(40, 167, 69, 0.1);
            padding: 1px 4px;
            border-radius: 3px;
            font-style: italic;
        }        .header-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 0;
            margin-bottom: 30px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .stats-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        /* Professional Table Styles */
        .professional-table {
            font-size: 0.95em;
        }
        
        .professional-table thead th {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            font-size: 0.8em;
            letter-spacing: 0.5px;
            padding: 1rem 0.75rem;
            border-bottom: 2px solid #dee2e6;
        }
        
        .professional-table tbody tr {
            transition: all 0.2s ease;
            border-bottom: 1px solid #f8f9fa;
        }
        
        .professional-table tbody tr:hover {
            background-color: #f8f9fa;
            transform: translateX(2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .professional-table td {
            padding: 1rem 0.75rem;
            vertical-align: middle;
        }
        
        .course-indicator {
            width: 4px;
            height: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }
        
        .course-code-text {
            font-family: 'Monaco', 'Consolas', monospace;
            color: #495057;
            font-size: 0.9em;
        }
        
        .course-title {
            font-weight: 500;
            color: #2c3e50;
            line-height: 1.4;
        }
        
        .faculty-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8em;
        }
        
        .faculty-name {
            color: #495057;
            font-weight: 500;
        }
        
        .credit-badge {
            color: #495057;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .type-badge {
            padding: 0.4em 0.8em;
            border-radius: 20px;
            font-weight: 500;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .lab-badge {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }
        
        .theory-badge {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
        }
        
        .slots-text {
            font-family: 'Monaco', 'Consolas', monospace;
            color: #6c757d;
            font-size: 0.85em;
            background-color: #f8f9fa;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            border: 1px solid #e9ecef;
        }
        
        .available-text {
            font-family: 'Monaco', 'Consolas', monospace;
            color: #495057;
            font-size: 0.8em;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            border: 1px solid #d1ecf1;
        }
        
        .summary-item {
            padding: 0.5rem;
        }
        
        .summary-item h5 {
            font-weight: 700;
            margin: 0;
        }
        
        .card {
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }
        
        .card-footer {
            background-color: #f8f9fa !important;
            padding: 1.5rem;
        }
        
        @media (max-width: 768px) {
            .timetable-container {
                font-size: 0.8em;
            }
            
            .time-slot {
                min-height: 50px;
                padding: 4px;
            }
            
            .professional-table {
                font-size: 0.85em;
            }
            
            .professional-table th,
            .professional-table td {
                padding: 0.75rem 0.5rem;
            }
            
            .faculty-avatar {
                width: 28px;
                height: 28px;
                font-size: 0.7em;
            }
        }
        
        /* Autocomplete dropdown styles */
        .cursor-pointer {
            cursor: pointer;
        }
        
        .dropdown-item:hover {
            background-color: #f8f9fa;
        }
        
        .dropdown-item .fw-bold {
            color: #495057;
        }
        
        .dropdown-item .text-muted {
            font-size: 0.875em;
        }

        /* Dark Mode Styles */
        [data-theme="dark"] {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }

        [data-theme="dark"] html,
        [data-theme="dark"] body {
            background-color: #1a1a1a !important;
            color: #e0e0e0;
        }

        [data-theme="dark"] .container {
            background-color: transparent;
        }

        [data-theme="dark"] .header-section {
            background: linear-gradient(135deg, #2d1b69 0%, #7b1fa2 100%);
        }

        [data-theme="dark"] .time-slot {
            background-color: #2d2d2d;
            border-color: #404040;
            color: #e0e0e0;
        }

        [data-theme="dark"] .time-slot.free {
            background-color: #1f1f1f;
            color: #9e9e9e;
            border-color: #404040;
        }

        [data-theme="dark"] .time-slot.occupied.theory-slot {
            background-color: rgba(33, 150, 243, 0.2);
            border-left-color: #2196f3;
        }

        [data-theme="dark"] .time-slot.occupied.lab-slot {
            background-color: rgba(76, 175, 80, 0.2);
            border-left-color: #4caf50;
        }

        [data-theme="dark"] .day-header {
            background: linear-gradient(135deg, #7b1fa2 0%, #d81b60 100%);
        }

        [data-theme="dark"] .stats-card {
            background-color: #2d2d2d;
            border-color: #404040;
            color: #e0e0e0;
        }

        [data-theme="dark"] .modal-content {
            background-color: #2d2d2d;
            color: #e0e0e0;
        }

        [data-theme="dark"] .modal-header {
            border-bottom-color: #404040;
        }

        [data-theme="dark"] .modal-footer {
            border-top-color: #404040;
        }

        [data-theme="dark"] .form-control {
            background-color: #1f1f1f;
            border-color: #404040;
            color: #e0e0e0;
        }

        [data-theme="dark"] .form-control:focus {
            background-color: #1f1f1f;
            border-color: #2196f3;
            color: #e0e0e0;
            box-shadow: 0 0 0 0.2rem rgba(33, 150, 243, 0.25);
        }

        [data-theme="dark"] .btn-outline-primary {
            color: #2196f3;
            border-color: #2196f3;
        }

        [data-theme="dark"] .btn-outline-primary:hover {
            background-color: #2196f3;
            border-color: #2196f3;
        }

        [data-theme="dark"] .dropdown-menu {
            background-color: #2d2d2d;
            border-color: #404040;
        }

        [data-theme="dark"] .dropdown-item {
            color: #e0e0e0;
        }

        [data-theme="dark"] .dropdown-item:hover {
            background-color: #404040;
            color: #fff;
        }

        [data-theme="dark"] .dropdown-item .fw-bold {
            color: #e0e0e0;
        }

        /* Additional dark mode styles for comprehensive coverage */
        [data-theme="dark"] * {
            border-color: #404040 !important;
        }

        [data-theme="dark"] h1, 
        [data-theme="dark"] h2, 
        [data-theme="dark"] h3, 
        [data-theme="dark"] h4, 
        [data-theme="dark"] h5, 
        [data-theme="dark"] h6 {
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] p, 
        [data-theme="dark"] span, 
        [data-theme="dark"] div, 
        [data-theme="dark"] small, 
        [data-theme="dark"] .text-muted {
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .lead {
            color: #b0b0b0 !important;
        }

        [data-theme="dark"] .text-primary {
            color: #4fc3f7 !important;
        }

        [data-theme="dark"] .text-success {
            color: #81c784 !important;
        }

        [data-theme="dark"] .text-info {
            color: #4dd0e1 !important;
        }

        [data-theme="dark"] .text-warning {
            color: #ffb74d !important;
        }

        [data-theme="dark"] .text-danger {
            color: #e57373 !important;
        }

        [data-theme="dark"] .btn {
            color: #e0e0e0 !important;
            border-color: #404040 !important;
        }

        [data-theme="dark"] .btn-primary {
            background-color: #2196f3 !important;
            border-color: #2196f3 !important;
        }

        [data-theme="dark"] .btn-success {
            background-color: #4caf50 !important;
            border-color: #4caf50 !important;
        }

        [data-theme="dark"] .btn-danger {
            background-color: #f44336 !important;
            border-color: #f44336 !important;
        }

        [data-theme="dark"] .btn-secondary {
            background-color: #666 !important;
            border-color: #666 !important;
        }

        [data-theme="dark"] .table {
            color: #e0e0e0 !important;
            background-color: #2d2d2d !important;
        }

        [data-theme="dark"] .table th,
        [data-theme="dark"] .table td {
            border-color: #404040 !important;
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .table-striped tbody tr:nth-of-type(odd) {
            background-color: #333 !important;
        }

        [data-theme="dark"] .card {
            background-color: #2d2d2d !important;
            border-color: #404040 !important;
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .card-header {
            background-color: #333 !important;
            border-color: #404040 !important;
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .list-group-item {
            background-color: #2d2d2d !important;
            border-color: #404040 !important;
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .alert {
            background-color: #2d2d2d !important;
            border-color: #404040 !important;
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .navbar {
            background-color: #1a1a1a !important;
        }

        [data-theme="dark"] .navbar-light .navbar-nav .nav-link {
            color: #e0e0e0 !important;
        }

        /* Dark mode styles for professional table and course list */
        [data-theme="dark"] .professional-table {
            background-color: #2d2d2d !important;
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .professional-table thead th {
            background: linear-gradient(135deg, #333 0%, #2d2d2d 100%) !important;
            color: #e0e0e0 !important;
            border-bottom-color: #404040 !important;
        }

        [data-theme="dark"] .professional-table tbody tr {
            border-bottom-color: #404040 !important;
            background-color: #2d2d2d !important;
        }

        [data-theme="dark"] .professional-table tbody tr:hover {
            background-color: #404040 !important;
            color: #fff !important;
        }

        [data-theme="dark"] .professional-table td {
            color: #e0e0e0 !important;
            border-color: #404040 !important;
        }

        [data-theme="dark"] .table-light {
            background-color: #333 !important;
        }

        [data-theme="dark"] .course-row {
            background-color: #2d2d2d !important;
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .course-row td {
            background-color: inherit !important;
            color: #e0e0e0 !important;
            border-color: #404040 !important;
        }

        [data-theme="dark"] .course-row.table-light {
            background-color: #333 !important;
        }

        [data-theme="dark"] .course-row.table-light td {
            background-color: #333 !important;
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .table tbody tr {
            background-color: #2d2d2d !important;
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .table tbody tr td {
            background-color: inherit !important;
            color: #e0e0e0 !important;
            border-color: #404040 !important;
        }

        [data-theme="dark"] .table-hover tbody tr:hover {
            background-color: #404040 !important;
            color: #fff !important;
        }

        [data-theme="dark"] .course-code-text {
            color: #4fc3f7 !important;
        }

        [data-theme="dark"] .course-indicator {
            background: linear-gradient(135deg, #7b1fa2 0%, #d81b60 100%) !important;
        }

        [data-theme="dark"] .fw-bold {
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .text-uppercase {
            color: #b0b0b0 !important;
        }

        /* Dark mode styles for timetable code section */
        [data-theme="dark"] .form-label {
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .form-label.fw-bold {
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .font-monospace {
            background-color: #1f1f1f !important;
            color: #e0e0e0 !important;
            border-color: #404040 !important;
        }

        [data-theme="dark"] .font-monospace::placeholder {
            color: #9e9e9e !important;
        }

        [data-theme="dark"] .text-warning {
            color: #ffb74d !important;
        }

        [data-theme="dark"] small {
            color: #b0b0b0 !important;
        }

        [data-theme="dark"] small.text-warning {
            color: #ffb74d !important;
        }

        /* Dark mode styles for time slots and course details */
        [data-theme="dark"] .slots-container {
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .slots-text {
            color: #4fc3f7 !important;
            font-weight: bold;
        }

        [data-theme="dark"] .course-title {
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .faculty-name {
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .credit-badge {
            background-color: #2196f3 !important;
            color: #fff !important;
        }

        [data-theme="dark"] .type-badge {
            color: #fff !important;
        }

        [data-theme="dark"] .lab-badge {
            background-color: #4caf50 !important;
        }

        [data-theme="dark"] .theory-badge {
            background-color: #2196f3 !important;
        }

        [data-theme="dark"] .badge {
            background-color: #404040 !important;
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .faculty-avatar {
            color: #b0b0b0 !important;
        }

        /* Dark mode styles for Add Course Modal */
        [data-theme="dark"] .modal-content {
            background-color: #2d2d2d !important;
            color: #e0e0e0 !important;
            border-color: #404040 !important;
        }

        [data-theme="dark"] .modal-header {
            background-color: #333 !important;
            border-bottom-color: #404040 !important;
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .modal-title {
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .modal-body {
            background-color: #2d2d2d !important;
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .modal-footer {
            background-color: #333 !important;
            border-top-color: #404040 !important;
        }

        [data-theme="dark"] .btn-close {
            filter: invert(1) !important;
        }

        /* Form inputs in Add Course modal */
        [data-theme="dark"] .form-control {
            background-color: #1f1f1f !important;
            border-color: #404040 !important;
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .form-control::placeholder {
            color: #9e9e9e !important;
            opacity: 1 !important;
        }

        [data-theme="dark"] .form-control:focus {
            background-color: #1f1f1f !important;
            border-color: #2196f3 !important;
            color: #e0e0e0 !important;
            box-shadow: 0 0 0 0.2rem rgba(33, 150, 243, 0.25) !important;
        }

        [data-theme="dark"] .form-label {
            color: #e0e0e0 !important;
            font-weight: 500 !important;
        }

        [data-theme="dark"] .form-text {
            color: #b0b0b0 !important;
        }

        [data-theme="dark"] .form-text.text-muted {
            color: #9e9e9e !important;
        }

        [data-theme="dark"] small.form-text {
            color: #9e9e9e !important;
        }

        /* Dropdown in Add Course modal */
        [data-theme="dark"] .dropdown-menu {
            background-color: #2d2d2d !important;
            border-color: #404040 !important;
            color: #e0e0e0 !important;
        }

        [data-theme="dark"] .dropdown-item {
            color: #e0e0e0 !important;
            background-color: transparent !important;
        }

        [data-theme="dark"] .dropdown-item:hover,
        [data-theme="dark"] .dropdown-item:focus {
            background-color: #404040 !important;
            color: #fff !important;
        }

        [data-theme="dark"] .dropdown-item .fw-bold {
            color: #4fc3f7 !important;
        }

        [data-theme="dark"] .dropdown-item .text-muted {
            color: #9e9e9e !important;
        }

        [data-theme="dark"] .dropdown-item small {
            color: #9e9e9e !important;
        }

        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dark-mode-toggle:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }

        [data-theme="dark"] .dark-mode-toggle {
            background: rgba(255, 255, 255, 0.7);
            color: #000;
        }

        [data-theme="dark"] .dark-mode-toggle:hover {
            background: rgba(255, 255, 255, 0.9);
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Dark Mode Toggle Button -->
        <button class="dark-mode-toggle" @click="toggleDarkMode" :title="isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'">
            <i :class="isDarkMode ? 'fas fa-sun' : 'fas fa-moon'"></i>
        </button>

        <!-- Header Section -->
        <div class="header-section">
            <div class="container">
                <div class="row">
                    <div class="col-12 text-center">
                        <h1 class="display-4 mb-3">FFCX Timetable</h1>
                        <p class="lead">Collaborative FFCS Planning for VIT Students</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Stats Section -->
            <div class="row mb-4">
                <div class="col-md-3 col-6">
                    <div class="stats-card text-center">
                        <h4 class="text-primary" v-text="totalCourses"></h4>
                        <small class="text-muted">Total Courses</small>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stats-card text-center">
                        <h4 class="text-success" v-text="totalCourseCredits"></h4>
                        <small class="text-muted">Credits</small>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stats-card text-center">
                        <h4 class="text-warning" v-text="busyHours"></h4>
                        <small class="text-muted">Busy Hours</small>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stats-card text-center">
                        <h4 class="text-info" v-text="freeHours"></h4>
                        <small class="text-muted">Free Hours</small>
                    </div>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: rgba(0, 123, 255, 0.1); border-left: 4px solid #007bff;"></div>
                    <small>Theory</small>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: rgba(40, 167, 69, 0.1); border-left: 4px solid #28a745;"></div>
                    <small>Lab</small>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #f8f9fa; border: 1px dashed #dee2e6;"></div>
                    <small>Free Period</small>
                </div>
            </div>

            <!-- Loading State -->
            <div v-if="loading" class="loading">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3">Loading your timetable...</p>
            </div>

            <!-- Timetable -->
            <div v-else class="timetable-container">
                <div class="row">
                    <div v-for="(schedule, day) in orderedTimetable" :key="day" class="col-lg-2 col-md-4 col-sm-6 mb-4">
                        <div class="day-header" v-text="day">
                        </div>
                        <div v-for="(slot, index) in schedule" :key="index" 
                             :class="['time-slot', slot.course ? 'occupied' : 'free', slot.course && slot.slot && slot.slot.startsWith('L') ? 'lab-slot' : 'theory-slot']"
                             @click="showSlotDetails(day, slot, index)"
                             :title="slot.course ? `${slot.name} - ${slot.venue}` : 'Free Period'">
                            
                            <div class="time-label-compact">
                                <div class="theory-time" v-text="slot.theory_time"></div>
                                <div class="lab-time" v-text="slot.lab_time"></div>
                            </div>
                            
                            <div v-if="slot.course">
                                <div class="course-name" v-text="slot.name"></div>
                                <div class="faculty-venue" v-text="slot.venue"></div>
                                <div class="slot-info">
                                    <div class="selected-slot">
                                        <i class="fas fa-check-circle"></i>
                                        <span v-text="slot.slot" :style="{color: slot.slot && slot.slot.startsWith('L') ? '#28a745' : '#007bff'}"></span>
                                    </div>
                                </div>
                            </div>
                            <div v-else class="free-period-info">
                                <div class="course-name">Free Period</div>
                                <div class="available-slots-free" v-text="slot.available_slots"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Course List Table -->
            <div class="mt-5">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3 class="mb-0">
                        <i class="fas fa-book-open me-2 text-primary"></i>
                        Enrolled Courses
                    </h3>
                    <div class="d-flex gap-2 align-items-center">
                        <button class="btn btn-outline-secondary btn-sm" @click="showPreferencesModal" title="Manage Teacher Preferences" 
                                style="padding: 6px 12px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <i class="fas fa-cog me-1"></i>
                            <span class="small">Preferences</span>
                        </button>
                        <button class="btn btn-primary btn-sm rounded-circle d-flex align-items-center justify-content-center" 
                                @click="showAddCourseModal" title="Add Course" style="width: 36px; height: 36px;">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                
                <div v-if="loadingCourses" class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading courses...</span>
                    </div>
                    <p class="mt-3 text-muted">Loading course information...</p>
                </div>
                
                <div v-else class="card shadow-sm">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0 professional-table">
                                <thead>
                                    <tr>
                                        <th scope="col" class="border-0 text-uppercase fw-bold text-muted">
                                            <i class="fas fa-code me-2"></i>Course Code
                                        </th>
                                        <th scope="col" class="border-0 text-uppercase fw-bold text-muted">
                                            <i class="fas fa-graduation-cap me-2"></i>Course Name
                                        </th>
                                        <th scope="col" class="border-0 text-uppercase fw-bold text-muted">
                                            <i class="fas fa-user-tie me-2"></i>Faculty
                                        </th>
                                        <th scope="col" class="border-0 text-uppercase fw-bold text-muted text-center">
                                            <i class="fas fa-star me-2"></i>Credits
                                        </th>
                                        <th scope="col" class="border-0 text-uppercase fw-bold text-muted text-center">
                                            <i class="fas fa-tag me-2"></i>Type
                                        </th>
                                        <th scope="col" class="border-0 text-uppercase fw-bold text-muted">
                                            <i class="fas fa-clock me-2"></i>Time Slots
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="(course, index) in courses" :key="course.course_code" 
                                        class="course-row" :class="{'table-light': index % 2 === 0}">
                                        <td class="align-middle">
                                            <div class="d-flex align-items-center">
                                                <div class="course-indicator me-3"></div>
                                                <strong class="course-code-text" v-text="course.course_code"></strong>
                                            </div>
                                        </td>
                                        <td class="align-middle">
                                            <div class="course-name-container">
                                                <div class="course-title" v-text="course.name"></div>
                                            </div>
                                        </td>
                                        <td class="align-middle">
                                            <div class="d-flex align-items-center">
                                                <div class="faculty-avatar me-2">
                                                    <i class="fas fa-user"></i>
                                                </div>
                                                <span class="faculty-name" v-text="course.faculty"></span>
                                            </div>
                                        </td>
                                        <td class="align-middle text-center">
                                            <span class="badge credit-badge" v-text="course.credits"></span>
                                        </td>
                                        <td class="align-middle text-center">
                                            <span class="badge type-badge" 
                                                  :class="course.type.includes('Lab') ? 'lab-badge' : 'theory-badge'" 
                                                  v-text="course.type"></span>
                                        </td>
                                        <td class="align-middle">
                                            <div class="slots-container">
                                                <span class="slots-text" v-text="course.slots"></span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Timetable Code Section -->
            <div class="mt-4">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title mb-3">
                            <i class="fas fa-qrcode me-2 text-primary"></i>
                            Timetable Code
                        </h5>
                        <p class="text-muted small mb-3">
                            Export your timetable as a code to share or backup, or import someone else's timetable using their code.
                        </p>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Export Current Timetable</label>
                                <div class="d-grid">
                                    <button class="btn btn-outline-primary" @click="generateTimetableCode" :disabled="loadingExport">
                                        <i class="fas fa-download me-2"></i>
                                        <span v-if="loadingExport">Generating...</span>
                                        <span v-else>Generate Code</span>
                                    </button>
                                </div>
                                <div v-if="generatedCode" class="mt-3">
                                    <label class="form-label small">Your Timetable Code:</label>
                                    <div class="input-group">
                                        <input v-model="generatedCode" type="text" class="form-control font-monospace small" readonly>
                                        <button class="btn btn-outline-secondary" @click="copyCode" :title="copyStatus">
                                            <i :class="copyIcon"></i>
                                        </button>
                                    </div>
                                    <small class="text-success">
                                        <i class="fas fa-check-circle me-1"></i>
                                        Code generated! Share this code to let others import your timetable.
                                    </small>
                                </div>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Import Timetable from Code</label>
                                <div class="input-group mb-2">
                                    <input v-model="importCode" type="text" class="form-control font-monospace" 
                                           placeholder="Paste timetable code here..." :disabled="loadingImport">
                                    <button class="btn btn-success" @click="importTimetableCode" :disabled="!importCode.trim() || loadingImport">
                                        <i class="fas fa-upload me-2"></i>
                                        <span v-if="loadingImport">Loading...</span>
                                        <span v-else>Import</span>
                                    </button>
                                </div>
                                <small class="text-warning">
                                    <i class="fas fa-exclamation-triangle me-1"></i>
                                    This will replace your current timetable!
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Course Details Modal -->
            <div v-if="selectedSlot" class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);" @click.self="closeModal">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <span v-text="selectedDay"></span> - <span v-text="selectedSlot.time"></span>
                            </h5>
                            <button type="button" class="btn-close" @click="closeModal"></button>
                        </div>
                        <div class="modal-body">
                            <div v-if="selectedSlot.course">
                                <p><strong>Course Code:</strong> <span v-text="selectedSlot.course_code || 'N/A'"></span></p>
                                <p><strong>Course Name:</strong> <span v-text="selectedSlot.name"></span></p>
                                <p><strong>Faculty:</strong> <span v-text="selectedSlot.faculty"></span></p>
                                <p><strong>Venue:</strong> <span v-text="selectedSlot.venue"></span></p>
                                <p><strong>Slot:</strong> <span v-text="selectedSlot.slot" :style="{color: selectedSlot.slot && selectedSlot.slot.startsWith('L') ? '#28a745' : '#007bff', fontWeight: 'bold'}"></span></p>
                            </div>
                            <div v-else>
                                <p><em>This is a free period. You can use this time for:</em></p>
                                <ul>
                                    <li>Self-study</li>
                                    <li>Project work</li>
                                    <li>Group discussions</li>
                                    <li>Library time</li>
                                </ul>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button v-if="selectedSlot.course" type="button" class="btn btn-danger me-2" @click="removeCourse">
                                <i class="fas fa-trash"></i> Remove Course
                            </button>
                            <button type="button" class="btn btn-secondary" @click="closeModal">Close</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Course Modal -->
            <div v-if="showAddModal" class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);" @click.self="closeAddModal">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <i class="fas fa-plus-circle me-2"></i>Add Course
                            </h5>
                            <button type="button" class="btn-close" @click="closeAddModal"></button>
                        </div>
                        <div class="modal-body">
                            <form @submit.prevent="addCourse">
                                <div class="mb-3 position-relative">
                                    <label class="form-label">Course Name</label>
                                    <input v-model="courseSearchQuery" 
                                           @input="searchCourses" 
                                           @focus="showCourseDropdown = true"
                                           type="text" class="form-control" required 
                                           placeholder="Start typing course name (e.g., Computer Programming)"
                                           autocomplete="off">
                                    
                                    <!-- Course dropdown -->
                                    <div v-if="showCourseDropdown && searchResults.length > 0" 
                                         class="dropdown-menu show w-100 mt-1" style="max-height: 200px; overflow-y: auto;">
                                        <div v-for="course in searchResults" :key="course.course_code" 
                                             @click="selectCourse(course)"
                                             class="dropdown-item cursor-pointer">
                                            <div class="fw-bold" v-text="course.title"></div>
                                            <small class="text-muted">
                                                <span v-text="course.course_code"></span> • 
                                                <span v-text="course.type"></span> • 
                                                <span v-text="course.credits"></span> credits
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Course Code</label>
                                        <input v-model="newCourse.course_code" type="text" class="form-control"
                                               placeholder="Enter or select from dropdown">
                                        <small class="form-text text-muted">Auto-filled when you select a course above</small>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Course Type</label>
                                        <input v-model="newCourse.course_type" type="text" class="form-control"
                                               placeholder="Enter or select from dropdown">
                                        <small class="form-text text-muted">Auto-filled when you select a course above</small>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Credits</label>
                                        <input v-model="newCourse.credits" type="number" step="0.5" class="form-control"
                                               placeholder="Enter credits">
                                        <small class="form-text text-muted">Auto-filled when you select a course above</small>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Slot(s)</label>
                                        <input v-model="newCourse.slot" type="text" class="form-control" required 
                                               placeholder="Enter slot(s) (e.g., A1, B2+L31, A1+A2)">
                                        <small class="form-text text-muted">Use + to combine multiple slots (e.g., A1+L5 for theory+lab)</small>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Faculty Name</label>
                                    <input v-model="newCourse.faculty" type="text" class="form-control" required 
                                           placeholder="Enter faculty name">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Venue</label>
                                    <input v-model="newCourse.venue" type="text" class="form-control" required 
                                           placeholder="Enter venue (e.g., SJT101, AB2-201)">
                                </div>

                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" @click="closeAddModal">Cancel</button>
                            <button type="button" class="btn btn-primary" @click="addCourse" :disabled="!isFormValid">
                                <i class="fas fa-plus"></i> Add Course
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preferences Modal -->
            <div v-if="showPreferences" class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);" @click.self="closePreferencesModal">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <i class="fas fa-star me-2"></i>Teacher Preferences & Optimization
                            </h5>
                            <button type="button" class="btn-close" @click="closePreferencesModal"></button>
                        </div>
                        <div class="modal-body">
                            <p class="text-muted mb-4">
                                Set multiple teacher options and priorities for each course. You can add any course here, even if it's not currently enrolled. The optimizer will try to find the best possible timetable based on your preferences.
                                <br><strong>Priority System:</strong> Lower numbers = Higher priority (1 = highest, 10 = lowest)
                            </p>

                            <!-- Add New Course Section -->
                            <div class="card mb-4 border-primary">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0"><i class="fas fa-plus-circle me-2"></i>Add New Course Preference</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3 position-relative">
                                        <label class="form-label">Course Name</label>
                                        <input v-model="newCourseSearchQuery" 
                                               @input="searchCoursesForPreferences" 
                                               @focus="showPreferenceCourseDropdown = true"
                                               type="text" class="form-control" 
                                               placeholder="Start typing course name (e.g., Computer Programming)"
                                               autocomplete="off">
                                        
                                        <!-- Course dropdown for preferences -->
                                        <div v-if="showPreferenceCourseDropdown && preferenceSearchResults.length > 0" 
                                             class="dropdown-menu show w-100 mt-1" style="max-height: 200px; overflow-y: auto;">
                                            <div v-for="course in preferenceSearchResults" :key="course.course_code" 
                                                 @click="selectCourseForPreference(course)"
                                                 class="dropdown-item cursor-pointer">
                                                <div class="fw-bold" v-text="course.title"></div>
                                                <small class="text-muted">
                                                    <span v-text="course.course_code"></span> • 
                                                    <span v-text="course.type"></span> • 
                                                    <span v-text="course.credits"></span> credits
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Course Code</label>
                                            <input type="text" class="form-control" v-model="newCoursePreference.code" 
                                                   placeholder="e.g., CSE2001">
                                            <small class="form-text text-muted">Auto-filled when you select a course above</small>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Course Type</label>
                                            <input type="text" class="form-control" v-model="newCoursePreference.type" 
                                                   placeholder="Theory/Lab">
                                            <small class="form-text text-muted">Auto-filled when you select a course above</small>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Priority</label>
                                            <input type="number" min="1" max="10" class="form-control" 
                                                   v-model.number="newCoursePreference.priority">
                                            <small class="form-text text-muted">Lower number = higher priority (1-10)</small>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary btn-sm" @click="addNewCoursePreference">
                                        <i class="fas fa-plus me-1"></i> Add Course
                                    </button>
                                </div>
                            </div>

                            <!-- Existing Courses from Timetable -->
                            <div v-if="courses.length > 0" class="mb-3">
                                <h6><i class="fas fa-book me-2"></i>Currently Enrolled Courses</h6>
                            </div>

                            <!-- All Course Preferences -->
                            <div v-if="Object.keys(preferences).length === 0" class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                No course preferences set. Add courses above or enroll in courses first.
                            </div>

                            <div v-for="(pref, courseName) in preferences" :key="courseName" class="card mb-3">
                                <div class="card-header">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h6 class="mb-0" v-text="courseName"></h6>
                                            <small class="text-muted" v-text="pref.code || 'Custom Course'"></small>
                                        </div>
                                        <div class="col-auto d-flex align-items-center gap-3">
                                            <div>
                                                <label class="form-label small mb-1">Subject Priority</label>
                                                <input type="number" min="1" max="10" class="form-control form-control-sm" style="width: 80px;"
                                                       v-model.number="pref.priority" title="Lower number = higher priority">
                                                <small class="text-muted" style="font-size: 0.7em;">1=highest</small>
                                            </div>
                                            <button class="btn btn-sm btn-outline-danger" @click="removeCoursePreference(courseName)">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label">Teacher Options</label>
                                        <div v-if="pref.teacherOptions.length === 0" class="text-muted mb-2">
                                            No teacher options added yet.
                                        </div>
                                        <div v-for="(option, index) in pref.teacherOptions" 
                                             :key="index" class="border rounded p-3 mb-2">
                                            <div class="row">
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small">Faculty</label>
                                                    <input v-model="option.faculty" type="text" class="form-control form-control-sm" 
                                                           placeholder="Dr. Name">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small">Slots</label>
                                                    <input v-model="option.slots" type="text" class="form-control form-control-sm" 
                                                           placeholder="A1, B1+L5">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small">Venue</label>
                                                    <input v-model="option.venue" type="text" class="form-control form-control-sm" 
                                                           placeholder="SJT101">
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <label class="form-label small">Priority</label>
                                                    <input v-model.number="option.priority" type="number" min="1" max="10" 
                                                           class="form-control form-control-sm" title="Lower number = higher priority">
                                                    <small class="form-text text-muted">1=highest</small>
                                                </div>
                                                <div class="col-md-1 mb-2 d-flex align-items-end">
                                                    <button @click="removeTeacherOption(courseName, index)" 
                                                            class="btn btn-sm btn-outline-danger">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <button @click="addTeacherOption(courseName)" class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-plus me-1"></i> Add Teacher Option
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" @click="closePreferencesModal">Close</button>
                            <button type="button" class="btn btn-success" @click="savePreferences">
                                <i class="fas fa-save me-1"></i> Save Preferences
                            </button>
                            <button type="button" class="btn btn-primary" @click="optimizeTimetable">
                                <i class="fas fa-magic me-1"></i> Optimize Timetable
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Vue.js Application -->
    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    timetable: {},
                    courses: [],
                    availableCourses: [],
                    loading: true,
                    loadingCourses: true,
                    selectedSlot: null,
                    selectedDay: '',
                    selectedTimeIndex: -1,
                    showAddModal: false,
                    newCourse: {
                        subject_name: '',
                        course_code: '',
                        course_type: '',
                        credits: '',
                        slot: '',
                        faculty: '',
                        venue: ''
                    },
                    courseSearchQuery: '',
                    searchResults: [],
                    showCourseDropdown: false,
                    totalCourses: 0,
                    busyHours: 0,
                    freeHours: 0,
                    dayOrder: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
                    // Timetable code functionality
                    generatedCode: '',
                    importCode: '',
                    // Dark mode
                    isDarkMode: false,
                    // Preferences modal
                    showPreferences: false,
                    preferences: {},
                    newCoursePreference: {
                        name: '',
                        code: '',
                        type: '',
                        priority: 5
                    },
                    // Course search for preferences
                    newCourseSearchQuery: '',
                    preferenceSearchResults: [],
                    showPreferenceCourseDropdown: false,
                    loadingExport: false,
                    loadingImport: false,
                    copyStatus: 'Copy to clipboard',
                    copyIcon: 'fas fa-copy'
                }
            },
            computed: {
                orderedTimetable() {
                    const ordered = {};
                    this.dayOrder.forEach(day => {
                        if (this.timetable[day]) {
                            ordered[day] = this.timetable[day];
                        }
                    });
                    return ordered;
                },
                totalCourseCredits() {
                    return this.courses.reduce((total, course) => total + course.credits, 0);
                },
                theoryCourses() {
                    return this.courses.filter(course => course.type === 'Theory').length;
                },
                labCourses() {
                    return this.courses.filter(course => course.type.includes('Lab')).length;
                },
                availableSlots() {
                    if (!this.selectedSlot) return [];
                    return this.selectedSlot.available_slots.split('/');
                },
                isFormValid() {
                    return this.newCourse.subject_name && 
                           this.newCourse.slot &&
                           this.newCourse.faculty && 
                           this.newCourse.venue;
                }
            },
            mounted() {
                // Initialize dark mode from localStorage
                const savedDarkMode = localStorage.getItem('darkMode');
                if (savedDarkMode === 'true') {
                    this.isDarkMode = true;
                    document.documentElement.setAttribute('data-theme', 'dark');
                } else {
                    document.documentElement.setAttribute('data-theme', 'light');
                }
                
                this.fetchTimetable();
                this.fetchCourses();
                this.fetchAvailableCourses();
                
                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.position-relative')) {
                        this.showCourseDropdown = false;
                        this.showPreferenceCourseDropdown = false;
                    }
                });
            },
            methods: {
                async fetchTimetable() {
                    try {
                        const response = await fetch('/api/timetable');
                        const data = await response.json();
                        this.timetable = data;
                        this.calculateStats();
                        this.loading = false;
                    } catch (error) {
                        console.error('Error fetching timetable:', error);
                        this.loading = false;
                    }
                },

                async fetchCourses() {
                    try {
                        const response = await fetch('/api/courses');
                        const data = await response.json();
                        this.courses = data;
                        this.loadingCourses = false;
                    } catch (error) {
                        console.error('Error fetching courses:', error);
                        this.loadingCourses = false;
                    }
                },

                async fetchAvailableCourses() {
                    try {
                        const response = await fetch('/api/available-courses');
                        const data = await response.json();
                        this.availableCourses = data;
                    } catch (error) {
                        console.error('Error fetching available courses:', error);
                    }
                },
                
                calculateStats() {
                    let courses = new Set();
                    let busyCount = 0;
                    let freeCount = 0;
                    
                    Object.values(this.timetable).forEach(day => {
                        day.forEach(slot => {
                            if (slot.course) {
                                courses.add(slot.course);
                                busyCount++;
                            } else {
                                freeCount++;
                            }
                        });
                    });
                    
                    this.totalCourses = courses.size;
                    this.busyHours = busyCount;
                    this.freeHours = freeCount;
                },
                
                showSlotDetails(day, slot, index = -1) {
                    this.selectedDay = day;
                    this.selectedSlot = slot;
                    this.selectedTimeIndex = index;
                },
                
                closeModal() {
                    this.selectedSlot = null;
                    this.selectedDay = '';
                    this.selectedTimeIndex = -1;
                },

                showAddCourseModal() {
                    this.showAddModal = true;
                    this.resetNewCourse();
                },

                closeAddModal() {
                    this.showAddModal = false;
                    this.resetNewCourse();
                },

                resetNewCourse() {
                    this.newCourse = {
                        subject_name: '',
                        course_code: '',
                        course_type: '',
                        credits: '',
                        slot: '',
                        faculty: '',
                        venue: ''
                    };
                    this.courseSearchQuery = '';
                    this.searchResults = [];
                    this.showCourseDropdown = false;
                },

                async searchCourses() {
                    if (this.courseSearchQuery.length < 1) {
                        this.searchResults = [];
                        this.showCourseDropdown = false;
                        return;
                    }

                    try {
                        const response = await fetch(`/api/search-courses?q=${encodeURIComponent(this.courseSearchQuery)}`);
                        const results = await response.json();
                        this.searchResults = results;
                        this.showCourseDropdown = results.length > 0;
                    } catch (error) {
                        console.error('Error searching courses:', error);
                        this.searchResults = [];
                        this.showCourseDropdown = false;
                    }
                },

                selectCourse(course) {
                    this.newCourse.subject_name = course.title;
                    this.newCourse.course_code = course.course_code;
                    this.newCourse.course_type = course.type;
                    this.newCourse.credits = course.credits;
                    this.courseSearchQuery = course.title;
                    this.showCourseDropdown = false;
                    this.searchResults = [];
                },



                async addCourse() {
                    if (!this.newCourse.subject_name || !this.newCourse.slot || !this.newCourse.faculty || !this.newCourse.venue) {
                        alert('Please fill in all fields');
                        return;
                    }

                    try {
                        const response = await fetch('/api/add-course', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(this.newCourse)
                        });

                        const result = await response.json();
                        if (result.success) {
                            await this.fetchTimetable();
                            await this.fetchCourses();
                            this.closeAddModal();
                            alert(result.message);
                        } else {
                            alert('Error adding course: ' + result.message);
                        }
                    } catch (error) {
                        console.error('Error adding course:', error);
                        alert('Error adding course');
                    }
                },

                async removeCourse() {
                    try {
                        const response = await fetch('/api/remove-course', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                day: this.selectedDay,
                                time_index: this.selectedTimeIndex
                            })
                        });

                        const result = await response.json();
                        if (result.success) {
                            await this.fetchTimetable();
                            await this.fetchCourses();
                            this.closeModal();
                        } else {
                            alert('Error removing course: ' + result.message);
                        }
                    } catch (error) {
                        console.error('Error removing course:', error);
                        alert('Error removing course');
                    }
                },

                async generateTimetableCode() {
                    this.loadingExport = true;
                    this.generatedCode = '';
                    
                    try {
                        const response = await fetch('/api/export-timetable');
                        const result = await response.json();
                        
                        if (result.success) {
                            this.generatedCode = result.code;
                            alert(`Timetable code generated! ${result.courses_count} courses exported.`);
                        } else {
                            alert('Error generating code: ' + result.message);
                        }
                    } catch (error) {
                        console.error('Error generating timetable code:', error);
                        alert('Error generating timetable code');
                    } finally {
                        this.loadingExport = false;
                    }
                },

                async importTimetableCode() {
                    if (!this.importCode.trim()) {
                        alert('Please enter a timetable code');
                        return;
                    }

                    this.loadingImport = true;
                    
                    try {
                        const response = await fetch('/api/import-timetable', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ code: this.importCode })
                        });

                        const result = await response.json();
                        
                        if (result.success) {
                            // Refresh timetable and courses
                            await this.fetchTimetable();
                            await this.fetchCourses();
                            this.importCode = '';
                            alert(result.message);
                        } else {
                            alert('Error importing timetable: ' + result.message);
                        }
                    } catch (error) {
                        console.error('Error importing timetable:', error);
                        alert('Error importing timetable');
                    } finally {
                        this.loadingImport = false;
                    }
                },

                async copyCode() {
                    if (!this.generatedCode) {
                        return;
                    }

                    try {
                        await navigator.clipboard.writeText(this.generatedCode);
                        this.copyStatus = 'Copied!';
                        this.copyIcon = 'fas fa-check text-success';
                        
                        setTimeout(() => {
                            this.copyStatus = 'Copy to clipboard';
                            this.copyIcon = 'fas fa-copy';
                        }, 2000);
                    } catch (error) {
                        // Fallback for browsers that don't support clipboard API
                        const textArea = document.createElement('textarea');
                        textArea.value = this.generatedCode;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        
                        this.copyStatus = 'Copied!';
                        this.copyIcon = 'fas fa-check text-success';
                        
                        setTimeout(() => {
                            this.copyStatus = 'Copy to clipboard';
                            this.copyIcon = 'fas fa-copy';
                        }, 2000);
                    }
                },

                showPreferencesModal() {
                    this.initializePreferences();
                    this.showPreferences = true;
                },

                closePreferencesModal() {
                    this.showPreferences = false;
                },

                initializePreferences() {
                    // Load saved preferences from localStorage
                    const saved = localStorage.getItem('ffcx_preferences');
                    if (saved) {
                        try {
                            this.preferences = JSON.parse(saved);
                        } catch (e) {
                            this.preferences = {};
                        }
                    }

                    // Initialize preferences for current courses if not already present
                    this.courses.forEach(course => {
                        const key = course.name || course.course_code;
                        if (!this.preferences[key]) {
                            this.preferences[key] = {
                                priority: 5,
                                code: course.course_code,
                                teacherOptions: [{
                                    faculty: course.faculty || '',
                                    slots: course.slots || '',
                                    venue: course.venue || '',
                                    priority: 5
                                }]
                            };
                        }
                    });
                },

                addNewCoursePreference() {
                    const courseName = this.newCourseSearchQuery.trim() || this.newCoursePreference.name.trim();
                    
                    if (!courseName) {
                        alert('Please enter a course name');
                        return;
                    }
                    
                    if (this.preferences[courseName]) {
                        alert('Course preference already exists');
                        return;
                    }

                    this.preferences[courseName] = {
                        priority: this.newCoursePreference.priority,
                        code: this.newCoursePreference.code.trim(),
                        type: this.newCoursePreference.type.trim(),
                        teacherOptions: []
                    };

                    // Reset form
                    this.newCoursePreference = {
                        name: '',
                        code: '',
                        type: '',
                        priority: 5
                    };
                    this.newCourseSearchQuery = '';
                    this.preferenceSearchResults = [];
                    this.showPreferenceCourseDropdown = false;
                },

                async searchCoursesForPreferences() {
                    if (this.newCourseSearchQuery.length < 1) {
                        this.preferenceSearchResults = [];
                        this.showPreferenceCourseDropdown = false;
                        return;
                    }

                    try {
                        const response = await fetch(`/api/search-courses?q=${encodeURIComponent(this.newCourseSearchQuery)}`);
                        const results = await response.json();
                        this.preferenceSearchResults = results;
                        this.showPreferenceCourseDropdown = results.length > 0;
                    } catch (error) {
                        console.error('Error searching courses for preferences:', error);
                        this.preferenceSearchResults = [];
                        this.showPreferenceCourseDropdown = false;
                    }
                },

                selectCourseForPreference(course) {
                    this.newCoursePreference.name = course.title;
                    this.newCoursePreference.code = course.course_code;
                    this.newCoursePreference.type = course.type;
                    this.newCourseSearchQuery = course.title;
                    this.showPreferenceCourseDropdown = false;
                    this.preferenceSearchResults = [];
                },

                removeCoursePreference(courseName) {
                    if (confirm(`Remove all preferences for "${courseName}"?`)) {
                        delete this.preferences[courseName];
                    }
                },

                addTeacherOption(courseKey) {
                    if (!this.preferences[courseKey]) {
                        this.preferences[courseKey] = { priority: 5, teacherOptions: [] };
                    }
                    this.preferences[courseKey].teacherOptions.push({
                        faculty: '',
                        slots: '',
                        venue: '',
                        priority: 5
                    });
                },

                removeTeacherOption(courseKey, index) {
                    if (this.preferences[courseKey] && this.preferences[courseKey].teacherOptions) {
                        this.preferences[courseKey].teacherOptions.splice(index, 1);
                    }
                },

                savePreferences() {
                    localStorage.setItem('ffcx_preferences', JSON.stringify(this.preferences));
                    alert('Preferences saved!');
                },

                async optimizeTimetable() {
                    try {
                        const response = await fetch('/api/optimize-timetable', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ preferences: this.preferences })
                        });

                        const result = await response.json();
                        
                        // Always refresh the timetable and courses to show changes
                        await this.fetchTimetable();
                        await this.fetchCourses();
                        
                        if (result.success) {
                            this.closePreferencesModal();
                            alert(`✅ Optimization completed successfully!\n\n${result.message}\n\nAssigned:\n${result.assigned.join('\n')}`);
                        } else {
                            let message = `⚠️ Optimization completed with issues:\n\n${result.message}`;
                            
                            if (result.assigned && result.assigned.length > 0) {
                                message += `\n\n✅ Successfully assigned:\n${result.assigned.join('\n')}`;
                            }
                            
                            if (result.failed && result.failed.length > 0) {
                                message += `\n\n❌ Failed to assign:\n${result.failed.join('\n')}`;
                            }
                            
                            if (result.clashes && result.clashes.length > 0) {
                                message += `\n\n⚠️ Clashes detected:\n${result.clashes.map(c => c.message).join('\n')}`;
                            }
                            
                            alert(message);
                        }
                    } catch (error) {
                        console.error('Error optimizing timetable:', error);
                        alert('Error optimizing timetable');
                    }
                },

                toggleDarkMode() {
                    this.isDarkMode = !this.isDarkMode;
                    document.documentElement.setAttribute('data-theme', this.isDarkMode ? 'dark' : 'light');
                    localStorage.setItem('darkMode', this.isDarkMode);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>